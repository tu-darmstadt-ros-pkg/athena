
Important: Read section 'Caveats' below before assembling!
## General description

The Power Distribution Board (PDB) is the main PCB inside the robot and has several functions:
1. It acts as a global power switch, connecting to the physical power button to turn the entire system on or off
2. It automatically selects from one of three available power sources to power the system: two 33V batteries and a 24V power supply
3. It distributes power to the system, forwarding the input from the selected power source to other components inside the robot and additionally providing 5V and 12V power outputs through internal voltage converters
4. It monitors input source and outputs bus voltages, as well as the currents from the two batteries
5. It implements battery safety features such as cell undervoltage protection

## Connections

The PDB has two power inputs labeled BAT A and BAT B which each connect to a 33V battery and a third input labeled EXT which connects to an external 24V power supply. 
There are four main power outputs labeled OUT:
- Two of them connect to the E-Stop board, to provide power to the main drive motors and flipper motors.
- One connects to a DC-DC converter, which provides 24V for the robot arm, Wi-Fi access point and LiDARs.
- One connects to a DC-DC converter, which provides 19V for the two PCs.
A power output labeled CAP should be connected to a large bulk capacitor, which stabilizes the power bus and prevents voltage drops during switching events.
Additionally, there are four 5V outputs and three 12V outputs available. The 5V outputs power the two battery monitoring PCBs and the LED on the physical power switch. The 12V outputs power the Ethernet switch inside the robot.
The PDB connects to a physical latching power button, through a connector labeled SW HS. Closing or opening this switch turns the entire robot on or off. A second connector labeled SW LS is also available to connect the separate logic ground plane to global ground. This switch is usually just bridged directly in normal operation.

## Communication interfaces

The PDB has four communication interfaces available. The most important one is the USB connection to the Teensy 4.0 which is used to monitor the PDB using a PC inside the robot. There are also I2C, SPI and UART interfaces available. The SPI interface is currently used to communicate with two battery monitoring PCBs. Their CS pins are currently mapped to the RX and TX pins of the UART interface.

## Devices on the PCB

There are several devices and ICs used on the PDB. Here is a brief description of their functions:

- Teensy4.0 microcontroller
	- This microcontroller is the heart of the PDB, implementing the logic for source selection and switching, as well as monitoring the functions of the PDB.
- ACS72981ELRATR-200U3
	- These ICs measure the currents from the two batteries and report them to the Teensy4.0 microcontroller.
- LTC7001IMSE-TRPBF
	- These are isolated gate driver modules, used to drive the three pairs of common-source n-MOSFETS which connect the input sources to the output power bus. They are controlled via three separate enable signals from the microcontroller.
- LM2594MX-5.0/NOPB
	- This is a buck converter, converting the 33V or 24V from the input to 5V for powering the Teensy4.0 microcontroller.
- LM2594MX-12.0/NOPB
	- This buck converter provides 12V for powering the LTC7001IMSE-TRPBF gate drivers.
- RPA50S-4812SWP
	- This is a DC-DC converter providing 12V power output at 50W.
- RPA50S-4805SWP
	- This is a DC-DC converter providing 5V power output at 50W.
    
## List of components

 - Passive components
	- Resistors
		- 3x 100Ω 1206
		- 4x 1kΩ 1206
		- 2x 4.7kΩ 1206
		- 4x 10kΩ 0805
		- 13x 100kΩ 0805
	- Ceramic capacitors
		- 2x 1nF 0805
		- 2x 10nF 0805
		- 3x 100nF 0805
		- 8x 1uF 0805
		- 2x 2.2uF 0805
	- Electrolytic capacitors
		- 2x 68uF Size 6.3x7.7mm
		- 2x 100uF Size 6.3x7.7mm
		- 2x 120uF Size 6.3x7.7mm
	- Diodes
		- 3x SL26PL-TP
		- 4x LED 0805
		- 2x SS12
	- Inductors
		- 2x 100uH ASPIAIG-S6055

- Connectors
	- 3x JST XH B2B XH-A
	- 6x JST EH B2B EH-A
	- 2x JST EH B3B EH-A
	- 1x JST XH B5B XH-A
	- 5x Amass XT30U-F
	- 3x Amass XT60-M

- MOSFETs
	- 6x IRFS4010TRLPBF

- ICs
	- 2x ACS72981ELRATR-200U3
	- 3x LTC7001IMSE-TRPBF
	- 1x LM2594MX-5.0/NOPB
	- 1x LM2594MX-12.0/NOPB

- Other devices
	- 1x RPA50S-4812SWP
	- 1x RPA50S-4805SWP
	- 1x Teensy4.0


## Caveats

For the current version of the firmware on the Teensy4.0 microcontroller to work properly, two pairs of pins on the microcontroller must be connected together using external wires:
1. Connect pins 8 and 28.
2. Connect pins 9 and 27.
Pins 8 and 9 are connected through the PCB to the current sensing ICs which measure the battery currents. Unfortunately, these pins do not support reading the analog voltages generated by the ICs. Therefore they must be connected to pins 28 and 27 which do support analog inputs.

The following resistors should NOT be soldered to the PCB for normal operation:
- R3
- R6
- R9
- R18
- R19
- R25
These resistors can be used to modify the voltages on the gates of the n-MOSFETs for testing purposes. For normal operation, simply leave the solder pads of these resistors open and unconnected.

The UART interface is currently non-functional, as the RX and TX pins are connected to the CS pins of two external battery monitoring PCBs that communicate with the PDB via SPI.

## Note

This documentation refers to the second generation Power Distribution Board.